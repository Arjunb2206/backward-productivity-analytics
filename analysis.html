<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Root Cause Analysis - Backward Analytics</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="components.css">
  <link rel="stylesheet" href="animations.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body style="display: flex; flex-direction: column; min-height: 100vh; background-color: var(--slate-50);">
  <nav></nav>

  <main style="flex: 1; max-width: 1400px; margin: 0 auto; padding: 2.5rem 1.5rem; width: 100%;">
    <div class="space-y-8 animate-fadeIn">
      <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <button onclick="history.back()" class="btn btn-secondary">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Back
        </button>
        
        <button onclick="showGeminiSummary()" class="btn" style="background: linear-gradient(135deg, #4285f4 0%, #9b51e0 50%, #e91e63 100%); display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; font-weight: 600;">
          <svg style="width: 20px; height: 20px;" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
          </svg>
          Gemini Summary
        </button>
      </div>

      <div id="analysisHeader"></div>

      <!-- Gemini Summary Modal -->
      <div id="geminiModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 16px; max-width: 900px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
          <div style="background: linear-gradient(135deg, #4285f4 0%, #9b51e0 50%, #e91e63 100%); padding: 1.5rem; border-radius: 16px 16px 0 0; display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center; gap: 0.75rem;">
              <svg style="width: 28px; height: 28px; color: white;" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
              </svg>
              <h2 style="margin: 0; color: white; font-size: 1.5rem; font-weight: 700;">Gemini AI Analysis</h2>
            </div>
            <button onclick="closeGeminiModal()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;">√ó</button>
          </div>
          
          <div style="padding: 2rem;">
            <div id="geminiLoading" style="text-align: center; padding: 3rem;">
              <div style="display: inline-block; width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid #4285f4; border-radius: 50%; animation: spin 1s linear infinite;"></div>
              <p style="margin-top: 1rem; color: #64748b;">Analyzing project data...</p>
            </div>
            
            <div id="geminiContent" style="display: none;">
              <!-- Project Overview -->
              <div style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
                <h3 style="margin: 0 0 0.5rem 0; color: #991b1b; font-size: 1.125rem; font-weight: 700;">üìä Project Overview</h3>
                <div id="geminiOverview" style="color: #7f1d1d; line-height: 1.6;"></div>
              </div>

              <!-- Problems Summary -->
              <div style="margin-bottom: 1.5rem;">
                <h3 style="margin: 0 0 1rem 0; color: #1e293b; font-size: 1.125rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem;">
                  <span style="background: #fee2e2; color: #991b1b; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px;">‚ö†Ô∏è</span>
                  Identified Problems
                </h3>
                <div id="geminiProblems" style="display: flex; flex-direction: column; gap: 1rem;"></div>
              </div>

              <!-- Root Causes -->
              <div style="margin-bottom: 1.5rem;">
                <h3 style="margin: 0 0 1rem 0; color: #1e293b; font-size: 1.125rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem;">
                  <span style="background: #dbeafe; color: #1e40af; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px;">üîç</span>
                  Root Causes Analysis
                </h3>
                <div id="geminiCauses" style="display: flex; flex-direction: column; gap: 1rem;"></div>
              </div>

              <!-- Delays Breakdown -->
              <div style="margin-bottom: 1.5rem;">
                <h3 style="margin: 0 0 1rem 0; color: #1e293b; font-size: 1.125rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem;">
                  <span style="background: #fef3c7; color: #92400e; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px;">‚è±Ô∏è</span>
                  Delay Impact Analysis
                </h3>
                <div id="geminiDelays" style="display: flex; flex-direction: column; gap: 1rem;"></div>
              </div>

              <!-- Recommendations -->
              <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 1.5rem; border-radius: 12px;">
                <h3 style="margin: 0 0 0.5rem 0; color: #1e40af; font-size: 1.125rem; font-weight: 700;">üí° AI Recommendations</h3>
                <div id="geminiRecommendations" style="color: #1e3a8a; line-height: 1.6;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="card" style="box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
          <div class="card-header" style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);">
            <h2 class="card-title" style="color: var(--red-800);">Delay Timeline</h2>
          </div>
          <div class="card-body" id="timelineViz"></div>
        </div>

        <div class="card" style="box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
          <div class="card-header" style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);">
            <h2 class="card-title" style="color: var(--red-800);">Root Causes</h2>
          </div>
          <div class="card-body" id="rootCauses"></div>
        </div>
      </div>

      <div class="card" style="box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
        <div class="card-header" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);">
          <h2 class="card-title">Detailed Task Analysis</h2>
        </div>
        <div class="card-body" id="taskAnalysis"></div>
      </div>
    </div>
  </main>

  <footer>
    System Status: <span class="footer-status">‚óè Live Engine Connected</span> &bull; 
    &copy; 2026 Corporate Productivity Analytics
  </footer>

  <style>
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>

  <script src="data.js"></script>
  <script src="utils.js"></script>
  <script src="auth.js"></script>
  <script src="app.js"></script>
  <script src="analysis.js"></script>
</body>
</html>

